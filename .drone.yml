kind: pipeline
type: docker 
name: deploy_dev

trigger:
  branch:
  - main

steps:
- name: build
  image: node:latest
  commands:
    - npm install
    - npm run build

- name: deploy
  image: byteflair/scp
  commands:
    - mv ./build ./dazzle_dev_staging
    - scp -r './dazzle_dev_staging' 'light@5.75.206.84:/home/light/'
    - ssh -t 'light@5.75.206.84' 'rm -rf /home/light/dazzle_dev/*'
    - ssh -t 'light@5.75.206.84' 'mv /home/light/dazzle_dev_staging/* /home/light/dazzle_dev/'
    - ssh -t 'light@5.75.206.84' 'chmod -R 755 /home/light/dazzle_dev/*'
    - ssh -t 'light@5.75.206.84' 'rm -rf /home/light/dazzle_dev_staging'

---
kind: pipeline
type: docker 
name: deploy_prod

trigger:
  event:
  - tag

steps:
- name: build
  image: node:latest
  commands:
    - npm install
    - npm run build

- name: deploy
  image: byteflair/scp
  commands: 
    - ssh 'light@5.75.206.84' 'rm -rf /home/light/dazzle/*'
    - mv ./build ./dazzle/
    - scp -r './dazzle/' 'light@5.75.206.84:/home/light/'

